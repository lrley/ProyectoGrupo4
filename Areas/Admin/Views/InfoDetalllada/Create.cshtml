@model DlaccessCore.Models.ViewModels.InfoDetalladaVM

@{
    ViewData["Title"] = "Crear Información Detallada";
}

<style>
    body {
        background-color: #f4f6f9;
    }

    .card {
        border-radius: 15px;
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    .card-header {
        border-radius: 15px 15px 0 0 !important;
        padding: 1rem 1.5rem;
        font-weight: 600;
    }

    .btn {
        border-radius: 10px;
        padding: 0.5rem 1.5rem;
    }

    /* Select2 estilos */
    .select2-container--bootstrap-5 .select2-selection {
        min-height: 38px;
        border-radius: 8px;
        border: 1px solid #ced4da;
    }

    .select2-container--bootstrap-5 .select2-selection__rendered {
        line-height: 36px;
    }

    .modal-content {
        border-radius: 20px;
        border: none;
    }

    .modal-header {
        border-radius: 20px 20px 0 0 !important;
    }

    .info-box {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1rem;
        height: 100%;
    }

    .info-label {
        font-size: 0.75rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
    }

    .info-value {
        font-weight: 600;
        color: #212529;
    }
</style>

<div class="container-fluid mt-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="m-0">Crear Información Detallada</h2>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Volver
        </a>
    </div>

    <form asp-action="Create" method="post" id="formCreate">

        <!-- ================= PERSONA ================= -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white bg-dark d-flex justify-content-between align-items-center">
                <h5 class="m-0"><i class="bi bi-person-circle"></i> Selección de Persona</h5>
                <span class="badge bg-white text-primary" id="badgePersona">Pendiente</span>
            </div>
            <div class="card-body p-4">

                <div class="row align-items-end">
                    <div class="col-md-8">
                        <label asp-for="InfoDetallada.IdPersona" class="form-label fw-bold">
                            Buscar Persona <span class="text-danger">*</span>
                        </label>
                        <select id="personaSelect" name="InfoDetallada.IdPersona"
                                class="form-select select2-persona" style="width: 100%;">
                            <option value="">-- Escriba para buscar persona --</option>
                            @if (Model.ListaPersonas != null)
                            {
                                foreach (var item in Model.ListaPersonas)
                                {
                                    <option value="@item.Value">@item.Text</option>
                                }
                            }
                        </select>
                        <span asp-validation-for="InfoDetallada.IdPersona" class="text-danger small"></span>
                    </div>

                    <div class="col-md-4">
                        <button type="button" id="btnVerPersona" class="btn btn-outline-primary w-100" disabled>
                            <i class="bi bi-eye"></i> Ver detalle persona
                        </button>
                    </div>
                </div>

                <div id="previewPersona" class="mt-3 preview-card d-none">
                    <div id="previewContent">
                        <!-- Se llena dinámicamente con JS -->
                    </div>
                </div>


            </div>
        </div>

   
        <!-- ================= CASA ================= -->
        <div class="card mb-4">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h5 class="m-0"><i class="bi bi-house-door-fill"></i> Selección de Casa</h5>
                <span class="badge bg-white text-primary" id="badgeCasa">Pendiente</span>
            </div>
            <div class="card-body p-4">

                <div class="row align-items-end">
                    <div class="col-md-8">
                        <label asp-for="InfoDetallada.CasaId" class="form-label fw-bold">
                            Buscar Casa <span class="text-danger">*</span>
                        </label>
                        <select id="casaSelect" name="InfoDetallada.IdCasa"
                                class="form-select select2-casa" style="width: 100%;">
                            <option value="">-- Escriba para buscar casa --</option>
                            @if (Model.ListaCasas != null)
                            {
                                foreach (var item in Model.ListaCasas)
                                {
                                    <option value="@item.Value">@item.Text</option>
                                }
                            }
                        </select>
                        <span asp-validation-for="InfoDetallada.CasaId" class="text-danger small"></span>
                    </div>

                    <div class="col-md-4">
                        <button type="button" id="btnVerCasa" class="btn btn-outline-primary w-100" disabled>
                            <i class="bi bi-eye"></i> Ver detalle casa
                        </button>
                    </div>
                </div>

                <!-- Preview dinámico -->
                <div id="previewCasa" class="mt-3 preview-card d-none">
                    <div id="previewCasaContent">
                        <!-- Se llena dinámicamente con JS -->
                    </div>
                </div>

            </div>
        </div>




        <!-- ================= DATOS ADICIONALES ================= -->
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="m-0"><i class="bi bi-card-list"></i> Datos de Acceso</h5>
            </div>
            <div class="card-body p-4">

                <div class="row g-3">
                    <div class="col-md-4">
                        <label asp-for="InfoDetallada.NumeroPlaca" class="form-label fw-bold">Placa Vehicular</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-car-front"></i></span>
                            <input asp-for="InfoDetallada.NumeroPlaca" class="form-control text-uppercase"
                                   placeholder="ABC-1234" maxlength="20" />
                        </div>
                        <span asp-validation-for="InfoDetallada.NumeroPlaca" class="text-danger small"></span>
                    </div>

                    <div class="col-md-4">
                        <label asp-for="InfoDetallada.NumeroTag" class="form-label fw-bold">Número de Tag</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-tag"></i></span>
                            <input asp-for="InfoDetallada.NumeroTag" class="form-control"
                                   placeholder="Solo números" maxlength="50" inputmode="numeric" />
                        </div>
                        <span asp-validation-for="InfoDetallada.NumeroTag" class="text-danger small"></span>
                    </div>

                    <div class="col-md-4">
                        <label asp-for="InfoDetallada.NumeroTarjeta" class="form-label fw-bold">Número de Tarjeta</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-credit-card"></i></span>
                            <input asp-for="InfoDetallada.NumeroTarjeta" class="form-control"
                                   placeholder="Solo números" maxlength="50" inputmode="numeric" />
                        </div>
                        <span asp-validation-for="InfoDetallada.NumeroTarjeta" class="text-danger small"></span>
                    </div>
                </div>

            </div>
        </div>

        <div class="d-flex justify-content-end gap-3 mb-5">
            <a asp-action="Index" class="btn btn-secondary btn-lg">Cancelar</a>
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-check-lg"></i> Guardar Información
            </button>
        </div>

    </form>
</div>

<!-- ================= MODAL PERSONA ================= -->
<div class="modal fade" id="modalPersona" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="bi bi-person-badge"></i> Detalle de Persona</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body p-4">
                <div class="row g-3" id="datosPersona">
                    <!-- Se llena dinámicamente -->
                    <div class="col-md-4">
                        <div class="info-box">
                            <div class="info-label">Nombre Completo</div>
                            <div class="info-value text-primary" id="mpNombre">-</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <div class="info-label">Cédula</div>
                            <div class="info-value" id="mpCedula">-</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <div class="info-label">Teléfono</div>
                            <div class="info-value" id="mpTelefono">-</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <div class="info-label">Email</div>
                            <div class="info-value" id="mpEmail">-</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <div class="info-label">Rol</div>
                            <div class="info-value"><span class="badge bg-info text-dark fs-6" id="mpRol">-</span></div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <div class="info-label">Tipo</div>
                            <div class="info-value"><span class="badge bg-secondary fs-6" id="mpTipo">-</span></div>
                        </div>
                    </div>
                </div>

                <div id="loadingPersona" class="text-center py-5 d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2 text-muted">Cargando información...</p>
                </div>
            </div>

            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg"></i> Cerrar
                </button>
            </div>

        </div>
    </div>
</div>

<!-- ================= MODAL CASA ================= -->
<div class="modal fade" id="modalCasa" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="bi bi-house-door-fill"></i> Detalle de Casa</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body p-4">
                <div class="row g-3" id="datosCasa">
                    <!-- Se llena dinámicamente -->
                    <div class="col-md-6">
                        <div class="info-box">
                            <div class="info-label">Familia</div>
                            <div class="info-value text-success" id="mcNombreFamilia">-</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-box">
                            <div class="info-label">Manzana</div>
                            <div class="info-value" id="mcManzana">-</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-box">
                            <div class="info-label">Villa</div>
                            <div class="info-value" id="mcVilla">-</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-box">
                            <div class="info-label">Etapa</div>
                            <div class="info-value" id="mcEtapa">-</div>
                        </div>
                    </div>
                </div>

                <div id="loadingCasa" class="text-center py-5 d-none">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2 text-muted">Cargando información de la casa...</p>
                </div>
            </div>

            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg"></i> Cerrar
                </button>
            </div>

        </div>
    </div>
</div>


@section Scripts {
    <!-- Select2 Bootstrap 5 Theme -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        /* Estilos para el preview mejorado */
        .preview-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
            border-left: 4px solid #0d6efd;
            border-radius: 10px;
            padding: 1rem;
        }

        .preview-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

            .preview-item:last-child {
                margin-bottom: 0;
            }

        .preview-icon {
            width: 28px;
            height: 28px;
            background: #0d6efd;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-size: 0.8rem;
        }

        .preview-label {
            font-size: 0.75rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 0.5rem;
        }

        .preview-value {
            font-weight: 600;
            color: #212529;
        }

            .preview-value.name {
                color: #0d6efd;
                font-size: 1.1rem;
            }

            .preview-value.cedula {
                color: #198754;
                font-family: monospace;
            }

            .preview-value.email {
                color: #6c757d;
                font-size: 0.9rem;
                word-break: break-all;
            }

        /* Estilos para el modal */
        .info-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            height: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        .info-value {
            font-weight: 600;
            color: #212529;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        #mpEmail {
            font-size: 0.85rem;
            word-break: break-all;
        }
    </style>

    <script src="~/js/InfoDetallada/InfoDetallada.js"></script>
    <script src="~/js/InfoDetallada/InfoDetalladaCasa.js"></script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}


